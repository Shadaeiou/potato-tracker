<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🥔 Potato Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    const Calculator = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/></svg>;
    const Clock = () => <svg className="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
    const Utensils = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3v7"/></svg>;
    const TrendingUp = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>;
    const Calendar = () => <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect width="18" height="18" x="3" y="4" rx="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>;

    function PotatoTracker() {
      const [view, setView] = useState('main');
      const [settings, setSettings] = useState(null);
      const [feeds, setFeeds] = useState([]);
      const [exercises, setExercises] = useState([]);
      const [history, setHistory] = useState({});
      const [weights, setWeights] = useState({});
      const [showWeightPrompt, setShowWeightPrompt] = useState(false);
      const [weightInput, setWeightInput] = useState('');
      const [selectedDay, setSelectedDay] = useState(null);
      const [inputs, setInputs] = useState({
        weight: '', heightFt: '', heightIn: '', age: '', gender: 'male', activity: '1.2',
        defPct: '18', defFlat: '', startHr: '4', endHr: '22'
      });
      const [newFeed, setNewFeed] = useState({ hour: '', cal: '', note: '' });
      const [newExercise, setNewExercise] = useState({ hour: '', cal: '', note: '' });
      const [editIdx, setEditIdx] = useState(null);
      const [editVals, setEditVals] = useState({ hour: '', cal: '', note: '' });
      const [editExIdx, setEditExIdx] = useState(null);
      const [editExVals, setEditExVals] = useState({ hour: '', cal: '', note: '' });
      
      // Calculator states
      const [showCalc, setShowCalc] = useState(false);
      const [savedFoods, setSavedFoods] = useState([]);
      const [newFood, setNewFood] = useState({ name: '', calories: '', servingSize: '' });
      const [calcItems, setCalcItems] = useState([]);

      useEffect(() => {
        const s = localStorage.getItem('ps');
        const f = localStorage.getItem('pf');
        const ex = localStorage.getItem('pex');
        const d = localStorage.getItem('pd');
        const h = localStorage.getItem('ph');
        const w = localStorage.getItem('pw');
        const foods = localStorage.getItem('pfoods');
        const lastPrompt = localStorage.getItem('plw');
        const today = new Date().toDateString();
        
        if (s) setSettings(JSON.parse(s));
        else setView('setup');
        if (h) setHistory(JSON.parse(h));
        if (w) setWeights(JSON.parse(w));
        if (foods) setSavedFoods(JSON.parse(foods));
        
        const now = new Date();
        if (now.getDay() === 1) {
          const thisMonday = new Date(now.getFullYear(), now.getMonth(), now.getDate()).toISOString().split('T')[0];
          if (lastPrompt !== thisMonday) {
            setShowWeightPrompt(true);
            localStorage.setItem('plw', thisMonday);
          }
        }
        
        if (f && d === today) {
          setFeeds(JSON.parse(f));
        } else if (d !== today && d && s) {
          const yest = new Date(d).toISOString().split('T')[0];
          const yf = f ? JSON.parse(f) : [];
          const yex = ex ? JSON.parse(ex) : [];
          const tot = yf.reduce((a, b) => a + b.cal, 0);
          const exTotal = yex.reduce((a, b) => a + b.cal, 0);
          const os = JSON.parse(s);
          const nh = h ? JSON.parse(h) : {};
          nh[yest] = { tot, exTotal, goal: os.goal, ok: (tot - exTotal) <= os.goal };
          setHistory(nh);
          localStorage.setItem('ph', JSON.stringify(nh));
          setFeeds([]);
          setExercises([]);
          localStorage.setItem('pf', '[]');
          localStorage.setItem('pex', '[]');
          localStorage.setItem('pd', today);
        } else {
          localStorage.setItem('pd', today);
        }
        
        if (ex && d === today) {
          setExercises(JSON.parse(ex));
        }
      }, []);

      useEffect(() => { localStorage.setItem('pf', JSON.stringify(feeds)); }, [feeds]);
      useEffect(() => { localStorage.setItem('pex', JSON.stringify(exercises)); }, [exercises]);
      useEffect(() => { localStorage.setItem('pfoods', JSON.stringify(savedFoods)); }, [savedFoods]);

      useEffect(() => {
        if (view === 'setup' && settings && !inputs.weight) {
          const deficit = settings.bmr - settings.goal;
          const deficitPct = ((deficit / settings.bmr) * 100).toFixed(1);
          setInputs(prev => ({
            ...prev,
            weight: settings.currentWeight?.toString() || '',
            heightFt: settings.heightFt?.toString() || '',
            heightIn: settings.heightIn?.toString() || '',
            age: settings.age?.toString() || '',
            gender: settings.gender || 'male',
            activity: settings.activity?.toString() || '1.2',
            startHr: settings.start.toString(),
            endHr: settings.end.toString(),
            defPct: deficitPct,
            defFlat: deficit.toString()
          }));
        }
      }, [view, settings]);

      const calcBMR = (weight, heightFt, heightIn, age, gender, activity) => {
        const kg = parseFloat(weight) * 0.453592;
        const cm = ((parseFloat(heightFt) * 12) + parseFloat(heightIn || 0)) * 2.54;
        const bmr = gender === 'male' ? 10 * kg + 6.25 * cm - 5 * parseFloat(age) + 5 : 10 * kg + 6.25 * cm - 5 * parseFloat(age) - 161;
        return Math.round(bmr * parseFloat(activity));
      };

      const handlePct = (v) => {
        if (!inputs.weight || !inputs.heightFt || !inputs.age) { setInputs({...inputs, defPct: v, defFlat: ''}); return; }
        const bmr = calcBMR(inputs.weight, inputs.heightFt, inputs.heightIn, inputs.age, inputs.gender, inputs.activity);
        setInputs({...inputs, defPct: v, defFlat: Math.round(bmr * parseFloat(v) / 100).toString()});
      };

      const handleFlat = (v) => {
        if (!inputs.weight || !inputs.heightFt || !inputs.age) { setInputs({...inputs, defFlat: v, defPct: ''}); return; }
        const bmr = calcBMR(inputs.weight, inputs.heightFt, inputs.heightIn, inputs.age, inputs.gender, inputs.activity);
        setInputs({...inputs, defFlat: v, defPct: ((parseFloat(v) / bmr) * 100).toFixed(1)});
      };

      const save = () => {
        if (!inputs.weight || !inputs.heightFt || !inputs.age) return;
        const bmr = calcBMR(inputs.weight, inputs.heightFt, inputs.heightIn, inputs.age, inputs.gender, inputs.activity);
        const def = inputs.defFlat ? parseFloat(inputs.defFlat) : Math.round(bmr * parseFloat(inputs.defPct) / 100);
        const ns = { 
          bmr, 
          goal: bmr - def, 
          start: parseInt(inputs.startHr), 
          end: parseInt(inputs.endHr),
          currentWeight: parseFloat(inputs.weight),
          heightFt: parseFloat(inputs.heightFt),
          heightIn: parseFloat(inputs.heightIn || 0),
          age: parseFloat(inputs.age),
          gender: inputs.gender,
          activity: parseFloat(inputs.activity)
        };
        setSettings(ns);
        localStorage.setItem('ps', JSON.stringify(ns));
        setView('main');
      };

      const getBudget = () => {
        if (!settings) return null;
        const hr = new Date().getHours();
        const { start, end, goal } = settings;
        const hrs = end >= start ? end - start + 1 : (24 - start) + end + 1;
        const perHr = Math.round(goal / hrs);
        const inWindow = end >= start ? hr >= start && hr <= end : hr >= start || hr <= end;
        if (!inWindow) return { msg: "Outside feasting hours", bud: 0, cons: 0, rem: 0, hr, exCal: 0 };
        let passed = 0, h = start;
        while (h !== hr) { passed++; h = (h + 1) % 24; }
        passed++;
        const bud = passed * perHr;
        const cons = feeds.reduce((a, b) => a + b.cal, 0);
        const exCal = exercises.reduce((a, b) => a + b.cal, 0);
        const netCons = cons - exCal;
        return { bud, cons: netCons, rem: bud - netCons, perHr, hr, goal, exCal, grossCons: cons };
      };

      const add = () => {
        const hour = newFeed.hour ? parseInt(newFeed.hour) : new Date().getHours();
        if (newFeed.cal) {
          setFeeds([...feeds, { hour, cal: parseInt(newFeed.cal), note: newFeed.note }]);
          setNewFeed({ hour: '', cal: '', note: '' });
        }
      };

      const addExercise = () => {
        const hour = newExercise.hour ? parseInt(newExercise.hour) : new Date().getHours();
        if (newExercise.cal) {
          setExercises([...exercises, { hour, cal: parseInt(newExercise.cal), note: newExercise.note }]);
          setNewExercise({ hour: '', cal: '', note: '' });
        }
      };

      const saveWeight = () => {
        if (weightInput && settings) {
          const today = new Date().toISOString().split('T')[0];
          const newWeights = {...weights, [today]: parseFloat(weightInput)};
          setWeights(newWeights);
          localStorage.setItem('pw', JSON.stringify(newWeights));
          
          // Update settings with new weight and recalculate BMR
          const newBmr = calcBMR(weightInput, settings.heightFt, settings.heightIn, settings.age, settings.gender, settings.activity);
          const deficit = settings.bmr - settings.goal;
          const updatedSettings = {
            ...settings,
            currentWeight: parseFloat(weightInput),
            bmr: newBmr,
            goal: newBmr - deficit
          };
          setSettings(updatedSettings);
          localStorage.setItem('ps', JSON.stringify(updatedSettings));
          
          setShowWeightPrompt(false);
          setWeightInput('');
        }
      };
      
      // Calculator functions
      const addFoodToLibrary = () => {
        if (newFood.name && newFood.calories && newFood.servingSize) {
          const food = {
            id: Date.now(),
            name: newFood.name,
            caloriesPerServing: parseFloat(newFood.calories),
            servingSize: parseFloat(newFood.servingSize)
          };
          setSavedFoods([...savedFoods, food]);
          setNewFood({ name: '', calories: '', servingSize: '' });
        }
      };

      const addFoodToCalc = (food) => {
        setCalcItems([...calcItems, { ...food, grams: food.servingSize }]);
      };

      const updateCalcItemGrams = (idx, grams) => {
        const updated = [...calcItems];
        updated[idx].grams = parseFloat(grams) || 0;
        setCalcItems(updated);
      };

      const removeCalcItem = (idx) => {
        setCalcItems(calcItems.filter((_, i) => i !== idx));
      };

      const getTotalCalories = () => {
        return Math.round(calcItems.reduce((total, item) => {
          const calPerGram = item.caloriesPerServing / item.servingSize;
          return total + (calPerGram * item.grams);
        }, 0));
      };

      const applyCaloriesToFeed = () => {
        const total = getTotalCalories();
        setNewFeed({ ...newFeed, cal: total.toString() });
        setShowCalc(false);
        setCalcItems([]);
      };

      const deleteSavedFood = (id) => {
        setSavedFoods(savedFoods.filter(f => f.id !== id));
      };

      const quick = (amt) => setFeeds([...feeds, { hour: new Date().getHours(), cal: amt, note: '' }]);
      const quickEx = (amt) => setExercises([...exercises, { hour: new Date().getHours(), cal: amt, note: '' }]);
      const del = (i) => { setFeeds(feeds.filter((_, idx) => idx !== i)); setEditIdx(null); };
      const delEx = (i) => { setExercises(exercises.filter((_, idx) => idx !== i)); setEditExIdx(null); };
      
      const startEdit = (i) => { 
        setEditIdx(i); 
        setEditVals({ hour: feeds[i].hour.toString(), cal: feeds[i].cal.toString(), note: feeds[i].note }); 
      };
      
      const saveEdit = (i) => {
        const u = [...feeds];
        u[i] = { hour: parseInt(editVals.hour), cal: parseInt(editVals.cal), note: editVals.note };
        setFeeds(u);
        setEditIdx(null);
      };

      const startEditEx = (i) => { 
        setEditExIdx(i); 
        setEditExVals({ hour: exercises[i].hour.toString(), cal: exercises[i].cal.toString(), note: exercises[i].note }); 
      };
      
      const saveEditEx = (i) => {
        const u = [...exercises];
        u[i] = { hour: parseInt(editExVals.hour), cal: parseInt(editExVals.cal), note: editExVals.note };
        setExercises(u);
        setEditExIdx(null);
      };

      const getStreak = () => {
        const d = Object.keys(history).sort().reverse();
        let s = 0, c = new Date();
        c.setDate(c.getDate() - 1);
        for (let i = 0; i < d.length; i++) {
          const k = c.toISOString().split('T')[0];
          if (d[i] === k && history[k].ok) { s++; c.setDate(c.getDate() - 1); }
          else break;
        }
        return s;
      };

      const getWeekly = () => {
        const w = new Date();
        w.setDate(w.getDate() - 7);
        const d = Object.entries(history).filter(([dt]) => new Date(dt) >= w);
        if (!d.length) return null;
        return {
          avg: Math.round(d.reduce((a, [, v]) => a + v.tot - (v.exTotal || 0), 0) / d.length),
          avgRem: Math.round(d.reduce((a, [, v]) => a + (v.goal - (v.tot - (v.exTotal || 0))), 0) / d.length),
          ok: d.filter(([, v]) => v.ok).length,
          tot: d.length
        };
      };

      // Calendar helper functions
      const getCalendarMonths = () => {
        const dates = Object.keys(history);
        if (dates.length === 0) return [];
        
        const sortedDates = dates.sort();
        const firstDate = new Date(sortedDates[0]);
        const lastDate = new Date(sortedDates[sortedDates.length - 1]);
        
        const months = [];
        let current = new Date(firstDate.getFullYear(), firstDate.getMonth(), 1);
        const end = new Date(lastDate.getFullYear(), lastDate.getMonth(), 1);
        
        while (current <= end) {
          months.push(new Date(current));
          current.setMonth(current.getMonth() + 1);
        }
        
        return months;
      };

      const getDaysInMonth = (year, month) => {
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();
        
        const days = [];
        
        // Add empty slots for days before month starts
        for (let i = 0; i < startingDayOfWeek; i++) {
          days.push(null);
        }
        
        // Add actual days
        for (let day = 1; day <= daysInMonth; day++) {
          days.push(new Date(year, month, day));
        }
        
        return days;
      };

      const b = getBudget();
      const st = getStreak();
      const ws = getWeekly();
      const prog = b && b.goal ? Math.min((b.cons / b.goal) * 100, 100) : 0;

      // Calculator Modal
      if (showCalc) {
        return (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div className="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
              <div className="sticky top-0 bg-white border-b p-6 flex justify-between items-center">
                <h2 className="text-2xl font-bold">🧮 Calorie Calculator</h2>
                <button onClick={() => { setShowCalc(false); setCalcItems([]); }} className="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
              </div>
              
              <div className="p-6 space-y-6">
                {/* Add New Food */}
                <div className="bg-blue-50 rounded-lg p-4">
                  <h3 className="font-semibold mb-3">Add New Food to Library</h3>
                  <div className="grid grid-cols-4 gap-3">
                    <div className="col-span-2">
                      <label className="block text-sm font-medium mb-1">Food Name</label>
                      <input type="text" value={newFood.name} onChange={(e) => setNewFood({...newFood, name: e.target.value})} placeholder="Gold Potato" className="w-full px-3 py-2 border rounded-lg" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Calories</label>
                      <input type="number" step="0.1" value={newFood.calories} onChange={(e) => setNewFood({...newFood, calories: e.target.value})} placeholder="40" className="w-full px-3 py-2 border rounded-lg" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Serving (g)</label>
                      <input type="number" step="0.1" value={newFood.servingSize} onChange={(e) => setNewFood({...newFood, servingSize: e.target.value})} placeholder="50" className="w-full px-3 py-2 border rounded-lg" />
                    </div>
                  </div>
                  <button onClick={addFoodToLibrary} className="mt-3 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium">Add to Library</button>
                </div>

                {/* Food Library */}
                <div>
                  <h3 className="font-semibold mb-3">Food Library</h3>
                  {savedFoods.length === 0 ? (
                    <p className="text-gray-500 text-center py-4">No saved foods yet. Add some above!</p>
                  ) : (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                      {savedFoods.map((food) => (
                        <div key={food.id} className="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
                          <div className="flex-1">
                            <p className="font-medium">{food.name}</p>
                            <p className="text-sm text-gray-600">{food.caloriesPerServing}cal / {food.servingSize}g</p>
                          </div>
                          <div className="flex gap-2">
                            <button onClick={() => addFoodToCalc(food)} className="px-3 py-1 bg-green-500 hover:bg-green-600 text-white rounded text-sm font-medium">Add</button>
                            <button onClick={() => deleteSavedFood(food.id)} className="px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-sm font-medium">×</button>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>

                {/* Current Calculation */}
                <div className="border-t pt-6">
                  <h3 className="font-semibold mb-3">Current Meal Calculation</h3>
                  {calcItems.length === 0 ? (
                    <p className="text-gray-500 text-center py-4">Add foods from your library above</p>
                  ) : (
                    <div className="space-y-3">
                      {calcItems.map((item, idx) => {
                        const calPerGram = item.caloriesPerServing / item.servingSize;
                        const itemTotal = Math.round(calPerGram * item.grams);
                        return (
                          <div key={idx} className="bg-amber-50 p-3 rounded-lg">
                            <div className="flex items-center gap-3">
                              <div className="flex-1">
                                <p className="font-medium">{item.name}</p>
                                <p className="text-xs text-gray-600">{item.caloriesPerServing}cal / {item.servingSize}g = {calPerGram.toFixed(2)}cal/g</p>
                              </div>
                              <div className="w-32">
                                <input type="number" step="0.1" value={item.grams} onChange={(e) => updateCalcItemGrams(idx, e.target.value)} className="w-full px-3 py-2 border rounded-lg text-center" />
                                <p className="text-xs text-gray-600 text-center mt-1">grams</p>
                              </div>
                              <div className="w-20 text-right">
                                <p className="text-lg font-bold text-orange-600">{itemTotal}</p>
                                <p className="text-xs text-gray-600">cal</p>
                              </div>
                              <button onClick={() => removeCalcItem(idx)} className="text-red-600 hover:text-red-700 font-bold text-xl">×</button>
                            </div>
                          </div>
                        );
                      })}
                      
                      <div className="bg-orange-100 border-2 border-orange-300 p-4 rounded-lg">
                        <div className="flex justify-between items-center">
                          <span className="text-lg font-semibold">Total Calories:</span>
                          <span className="text-3xl font-bold text-orange-700">{getTotalCalories()}</span>
                        </div>
                      </div>
                      
                      <button onClick={applyCaloriesToFeed} className="w-full py-3 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg text-lg">
                        Apply {getTotalCalories()} Calories to Feed
                      </button>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>
        );
      }

      if (showWeightPrompt) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 p-6 flex items-center justify-center">
            <div className="max-w-md w-full bg-white rounded-2xl shadow-xl p-8">
              <h2 className="text-2xl font-bold text-gray-800 mb-4">⚖️ Monday Weigh-In</h2>
              <p className="text-gray-600 mb-4">Track your progress! What's your current weight?</p>
              <div className="mb-4">
                <label className="block text-sm font-medium text-gray-700 mb-1">Weight (lbs)</label>
                <input type="number" step="0.1" value={weightInput} onChange={(e) => setWeightInput(e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" />
              </div>
              <p className="text-sm text-gray-600 mb-4">💡 Your BMR and daily goal will be automatically recalculated based on your new weight.</p>
              <div className="flex gap-2">
                <button onClick={saveWeight} className="flex-1 bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 rounded-lg">Save Weight</button>
                <button onClick={() => setShowWeightPrompt(false)} className="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg">Skip</button>
              </div>
            </div>
          </div>
        );
      }
      
      if (view === 'weights') {
        const sortedWeights = Object.entries(weights).sort(([a], [b]) => b.localeCompare(a));
        const latestWeight = sortedWeights.length > 0 ? sortedWeights[0][1] : null;
        const oldestWeight = sortedWeights.length > 0 ? sortedWeights[sortedWeights.length - 1][1] : null;
        const weightChange = latestWeight && oldestWeight ? (latestWeight - oldestWeight).toFixed(1) : null;
        
        const [editingWeight, setEditingWeight] = useState(null);
        const [editWeightVal, setEditWeightVal] = useState('');
        
        const startEditWeight = (date, weight) => {
          setEditingWeight(date);
          setEditWeightVal(weight.toString());
        };
        
        const saveWeightEdit = (date) => {
          if (editWeightVal && settings) {
            const newWeights = {...weights};
            const oldWeight = newWeights[date];
            newWeights[date] = parseFloat(editWeightVal);
            setWeights(newWeights);
            localStorage.setItem('pw', JSON.stringify(newWeights));
            
            // If editing the most recent weight, update settings
            const mostRecentDate = sortedWeights[0][0];
            if (date === mostRecentDate) {
              const newBmr = calcBMR(editWeightVal, settings.heightFt, settings.heightIn, settings.age, settings.gender, settings.activity);
              const deficit = settings.bmr - settings.goal;
              const updatedSettings = {
                ...settings,
                currentWeight: parseFloat(editWeightVal),
                bmr: newBmr,
                goal: newBmr - deficit
              };
              setSettings(updatedSettings);
              localStorage.setItem('ps', JSON.stringify(updatedSettings));
            }
            
            setEditingWeight(null);
          }
        };
        
        const deleteWeight = (date) => {
          const newWeights = {...weights};
          delete newWeights[date];
          setWeights(newWeights);
          localStorage.setItem('pw', JSON.stringify(newWeights));
          setEditingWeight(null);
        };
        
        // Prepare data for line chart
        const chartData = sortedWeights.reverse(); // Oldest to newest for chart
        const minWeight = chartData.length > 0 ? Math.min(...chartData.map(([, w]) => w)) : 0;
        const maxWeight = chartData.length > 0 ? Math.max(...chartData.map(([, w]) => w)) : 0;
        const weightRange = maxWeight - minWeight || 10;
        const chartHeight = 200;
        const chartWidth = 600;
        const padding = 40;
        
        const getX = (index) => padding + (index / (chartData.length - 1 || 1)) * (chartWidth - 2 * padding);
        const getY = (weight) => chartHeight - padding - ((weight - minWeight + weightRange * 0.1) / (weightRange * 1.2)) * (chartHeight - 2 * padding);
        
        const pathD = chartData.map(([date, weight], i) => 
          `${i === 0 ? 'M' : 'L'} ${getX(i)} ${getY(weight)}`
        ).join(' ');
        
        return (
          <div className="min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 p-6">
            <div className="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-8">
              <div className="flex justify-between items-center mb-6">
                <h1 className="text-3xl font-bold text-gray-800">⚖️ Weight Progress</h1>
                <button onClick={() => setView('main')} className="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg">Back</button>
              </div>
              
              {sortedWeights.length > 0 ? (
                <>
                  <div className="grid grid-cols-3 gap-4 mb-6">
                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                      <p className="text-sm text-gray-600 mb-1">Current Weight</p>
                      <p className="text-3xl font-bold text-blue-700">{latestWeight} lbs</p>
                    </div>
                    <div className="bg-purple-50 border border-purple-200 rounded-lg p-4">
                      <p className="text-sm text-gray-600 mb-1">Starting Weight</p>
                      <p className="text-3xl font-bold text-purple-700">{oldestWeight} lbs</p>
                    </div>
                    {weightChange && (
                      <div className={`border rounded-lg p-4 ${parseFloat(weightChange) <= 0 ? 'bg-green-50 border-green-200' : 'bg-orange-50 border-orange-200'}`}>
                        <p className="text-sm text-gray-600 mb-1">Total Change</p>
                        <p className={`text-3xl font-bold ${parseFloat(weightChange) <= 0 ? 'text-green-700' : 'text-orange-700'}`}>
                          {parseFloat(weightChange) > 0 ? '+' : ''}{weightChange} lbs
                        </p>
                      </div>
                    )}
                  </div>
                  
                  {/* Weight Chart */}
                  {chartData.length > 1 && (
                    <div className="bg-gradient-to-br from-blue-50 to-purple-50 rounded-lg p-6 mb-6">
                      <h3 className="text-lg font-semibold mb-4">Weight Trend</h3>
                      <div className="flex justify-center">
                        <svg viewBox={`0 0 ${chartWidth} ${chartHeight}`} className="w-full max-w-2xl">
                          {/* Grid lines */}
                          {[0, 1, 2, 3, 4].map(i => {
                            const y = padding + (i / 4) * (chartHeight - 2 * padding);
                            const weight = (maxWeight + weightRange * 0.1) - (i / 4) * (weightRange * 1.2);
                            return (
                              <g key={i}>
                                <line x1={padding} y1={y} x2={chartWidth - padding} y2={y} stroke="#e5e7eb" strokeWidth="1" />
                                <text x={padding - 5} y={y + 5} textAnchor="end" fontSize="12" fill="#6b7280">{weight.toFixed(1)}</text>
                              </g>
                            );
                          })}
                          
                          {/* Line */}
                          <path d={pathD} fill="none" stroke="#3b82f6" strokeWidth="3" />
                          
                          {/* Points */}
                          {chartData.map(([date, weight], i) => (
                            <g key={date}>
                              <circle cx={getX(i)} cy={getY(weight)} r="5" fill="#3b82f6" stroke="white" strokeWidth="2" />
                              <text x={getX(i)} y={chartHeight - 10} textAnchor="middle" fontSize="10" fill="#6b7280">
                                {new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                              </text>
                            </g>
                          ))}
                        </svg>
                      </div>
                    </div>
                  )}
                  
                  <div className="space-y-3">
                    <h3 className="text-lg font-semibold">Weight History</h3>
                    {sortedWeights.reverse().map(([date, weight]) => (
                      <div key={date} className="bg-gray-50 p-3 rounded-lg">
                        {editingWeight === date ? (
                          <div className="flex gap-2 items-center">
                            <span className="font-medium">{new Date(date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</span>
                            <input 
                              type="number" 
                              step="0.1" 
                              value={editWeightVal} 
                              onChange={(e) => setEditWeightVal(e.target.value)} 
                              className="w-24 px-2 py-1 border rounded" 
                            />
                            <span className="text-sm">lbs</span>
                            <button onClick={() => saveWeightEdit(date)} className="text-green-600 font-medium text-sm">Save</button>
                            <button onClick={() => setEditingWeight(null)} className="text-gray-600 font-medium text-sm">Cancel</button>
                            <button onClick={() => deleteWeight(date)} className="text-red-600 font-medium text-sm ml-auto">Delete</button>
                          </div>
                        ) : (
                          <div className="flex justify-between items-center">
                            <span className="font-medium">{new Date(date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</span>
                            <div className="flex items-center gap-3">
                              <span className="text-lg font-bold text-gray-800">{weight} lbs</span>
                              <div className="flex gap-2">
                                <button onClick={() => startEditWeight(date, weight)} className="text-blue-600 text-sm font-medium">Edit</button>
                                <button onClick={() => deleteWeight(date)} className="text-red-600 text-sm font-medium">Delete</button>
                              </div>
                            </div>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                </>
              ) : (
                <p className="text-center py-12 text-gray-500">No weight entries yet. Start tracking on Mondays!</p>
              )}
            </div>
          </div>
        );
      }

      // Day Detail Modal
      if (selectedDay) {
        const dayData = history[selectedDay];
        const date = new Date(selectedDay);
        const netCal = dayData.tot - (dayData.exTotal || 0);
        const diff = dayData.goal - netCal;
        
        return (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div className="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
              <div className="sticky top-0 bg-white border-b p-6 flex justify-between items-center">
                <div>
                  <h2 className="text-2xl font-bold">{date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}</h2>
                  <span className={`inline-block mt-2 px-3 py-1 rounded-full text-sm font-medium ${dayData.ok ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'}`}>
                    {dayData.ok ? '✓ Success' : '✗ Over Goal'}
                  </span>
                </div>
                <button onClick={() => setSelectedDay(null)} className="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
              </div>
              
              <div className="p-6 space-y-6">
                <div className="grid grid-cols-2 gap-4">
                  <div className="bg-orange-50 border border-orange-200 rounded-lg p-4">
                    <p className="text-sm text-gray-600 mb-1">Food Consumed</p>
                    <p className="text-3xl font-bold text-orange-700">{dayData.tot}</p>
                    <p className="text-xs text-gray-500 mt-1">calories</p>
                  </div>
                  <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                    <p className="text-sm text-gray-600 mb-1">Exercise Burned</p>
                    <p className="text-3xl font-bold text-green-700">{dayData.exTotal || 0}</p>
                    <p className="text-xs text-gray-500 mt-1">calories</p>
                  </div>
                  <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <p className="text-sm text-gray-600 mb-1">Net Calories</p>
                    <p className="text-3xl font-bold text-blue-700">{netCal}</p>
                    <p className="text-xs text-gray-500 mt-1">food - exercise</p>
                  </div>
                  <div className="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <p className="text-sm text-gray-600 mb-1">Daily Goal</p>
                    <p className="text-3xl font-bold text-purple-700">{dayData.goal}</p>
                    <p className="text-xs text-gray-500 mt-1">target</p>
                  </div>
                </div>
                
                <div className={`border-2 rounded-lg p-4 ${diff >= 0 ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`}>
                  <div className="flex justify-between items-center">
                    <span className="text-lg font-semibold">Difference from Goal:</span>
                    <span className={`text-3xl font-bold ${diff >= 0 ? 'text-green-700' : 'text-red-700'}`}>
                      {diff >= 0 ? '+' : ''}{diff} cal
                    </span>
                  </div>
                  <p className="text-sm text-gray-600 mt-2">
                    {diff >= 0 ? `You were ${diff} calories under your goal! 🎉` : `You were ${Math.abs(diff)} calories over your goal.`}
                  </p>
                </div>
                
                <div className="text-center">
                  <button onClick={() => setSelectedDay(null)} className="px-6 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg font-medium">Close</button>
                </div>
              </div>
            </div>
          </div>
        );
      }

    if (view === 'history') {
        const months = getCalendarMonths();
        
        return (
          <div className="min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 p-6">
            <div className="max-w-6xl mx-auto bg-white rounded-2xl shadow-xl p-8">
              <div className="flex justify-between items-center mb-6">
                <h1 className="text-3xl font-bold text-gray-800 flex items-center gap-2"><Calendar />History Calendar</h1>
                <button onClick={() => setView('main')} className="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg">Back</button>
              </div>
              
              {months.length === 0 ? (
                <p className="text-center py-12 text-gray-500">No history yet! Start tracking your feeds.</p>
              ) : (
                <div className="space-y-8">
                  {months.map(monthDate => {
                    const year = monthDate.getFullYear();
                    const month = monthDate.getMonth();
                    const days = getDaysInMonth(year, month);
                    const monthName = monthDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                    
                    return (
                      <div key={`${year}-${month}`} className="bg-gradient-to-br from-blue-50 to-purple-50 rounded-lg p-6">
                        <h2 className="text-2xl font-bold mb-4">{monthName}</h2>
                        <div className="grid grid-cols-7 gap-2">
                          {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                            <div key={day} className="text-center font-semibold text-gray-600 text-sm py-2">
                              {day}
                            </div>
                          ))}
                          {days.map((day, idx) => {
                            if (!day) {
                              return <div key={`empty-${idx}`} className="aspect-square" />;
                            }
                            
                            const dateStr = day.toISOString().split('T')[0];
                            const dayData = history[dateStr];
                            const isToday = dateStr === new Date().toISOString().split('T')[0];
                            
                            if (!dayData) {
                              return (
                                <div key={dateStr} className={`aspect-square flex items-center justify-center rounded-lg border-2 ${isToday ? 'border-blue-400 bg-blue-100' : 'border-gray-200 bg-white'}`}>
                                  <span className="text-gray-400 text-sm">{day.getDate()}</span>
                                </div>
                              );
                            }
                            
                            const netCal = dayData.tot - (dayData.exTotal || 0);
                            const isSuccess = dayData.ok;
                            
                            return (
                              <button
                                key={dateStr}
                                onClick={() => setSelectedDay(dateStr)}
                                className={`aspect-square flex flex-col items-center justify-center rounded-lg border-2 transition-all hover:scale-105 ${
                                  isSuccess 
                                    ? 'bg-green-100 border-green-400 hover:bg-green-200' 
                                    : 'bg-red-100 border-red-400 hover:bg-red-200'
                                } ${isToday ? 'ring-2 ring-blue-500' : ''}`}
                              >
                                <span className="font-bold text-lg">{day.getDate()}</span>
                                <span className="text-xs font-semibold mt-1">{netCal}</span>
                              </button>
                            );
                          })}
                        </div>
                      </div>
                    );
                  })}
                  
                  <div className="bg-white border rounded-lg p-4">
                    <h3 className="font-semibold mb-3">Legend</h3>
                    <div className="flex flex-wrap gap-4">
                      <div className="flex items-center gap-2">
                        <div className="w-8 h-8 bg-green-100 border-2 border-green-400 rounded"></div>
                        <span className="text-sm">Success (Under Goal)</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <div className="w-8 h-8 bg-red-100 border-2 border-red-400 rounded"></div>
                        <span className="text-sm">Over Goal</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <div className="w-8 h-8 bg-blue-100 border-2 border-blue-400 rounded"></div>
                        <span className="text-sm">Today</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <div className="w-8 h-8 bg-white border-2 border-gray-200 rounded"></div>
                        <span className="text-sm">No Data</span>
                      </div>
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      }

      if (view === 'setup' || !settings) {
        const canCalc = inputs.weight && inputs.heightFt && inputs.age;
        const bmr = canCalc ? calcBMR(inputs.weight, inputs.heightFt, inputs.heightIn, inputs.age, inputs.gender, inputs.activity) : null;
        return (
          <div className="min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 p-6">
            <div className="max-w-2xl mx-auto bg-white rounded-2xl shadow-xl p-8">
              <div className="flex items-center gap-3 mb-6">
                <div className="text-4xl">🥔</div>
                <h1 className="text-3xl font-bold">Potato Tracker Setup</h1>
              </div>
              <div className="space-y-6">
                <div className="bg-amber-50 p-6 rounded-lg space-y-4">
                  <h2 className="text-xl font-semibold flex items-center gap-2"><Calculator />Calculate BMR</h2>
                  <div className="grid grid-cols-2 gap-4">
                    <div><label className="block text-sm font-medium mb-1">Weight (lbs)</label><input type="number" step="0.1" value={inputs.weight} onChange={(e) => setInputs({...inputs, weight: e.target.value})} onBlur={() => inputs.defPct && canCalc && handlePct(inputs.defPct)} className="w-full px-3 py-2 border rounded-lg" /></div>
                    <div><label className="block text-sm font-medium mb-1">Height</label><div className="flex gap-2"><input type="number" min="0" max="8" value={inputs.heightFt} placeholder="ft" onChange={(e) => setInputs({...inputs, heightFt: e.target.value})} onBlur={() => inputs.defPct && canCalc && handlePct(inputs.defPct)} className="flex-1 px-3 py-2 border rounded-lg" /><input type="number" min="0" max="11" value={inputs.heightIn} placeholder="in" onChange={(e) => setInputs({...inputs, heightIn: e.target.value})} onBlur={() => inputs.defPct && canCalc && handlePct(inputs.defPct)} className="flex-1 px-3 py-2 border rounded-lg" /></div></div>
                    <div><label className="block text-sm font-medium mb-1">Age</label><input type="number" value={inputs.age} onChange={(e) => setInputs({...inputs, age: e.target.value})} onBlur={() => inputs.defPct && canCalc && handlePct(inputs.defPct)} className="w-full px-3 py-2 border rounded-lg" /></div>
                    <div><label className="block text-sm font-medium mb-1">Gender</label><select value={inputs.gender} onChange={(e) => setInputs({...inputs, gender: e.target.value})} className="w-full px-3 py-2 border rounded-lg"><option value="male">Male</option><option value="female">Female</option></select></div>
                  </div>
                  <div><label className="block text-sm font-medium mb-1">Activity Level</label><select value={inputs.activity} onChange={(e) => setInputs({...inputs, activity: e.target.value})} className="w-full px-3 py-2 border rounded-lg"><option value="1.2">Sedentary</option><option value="1.375">Lightly active</option><option value="1.55">Moderately active</option><option value="1.725">Very active</option><option value="1.9">Extremely active</option></select></div>
                  {bmr && <div className="bg-white p-3 rounded border"><p className="text-sm"><span className="font-semibold">BMR:</span> {bmr} cal/day</p></div>}
                </div>
                <div className="space-y-4">
                  <div><label className="block text-sm font-medium mb-1">Calorie Deficit</label><div className="grid grid-cols-2 gap-3"><div><input type="number" min="0" max="50" step="0.1" value={inputs.defPct} onChange={(e) => handlePct(e.target.value)} placeholder="%" className="w-full px-3 py-2 border rounded-lg" /><p className="text-xs text-gray-500 mt-1">Percent (%)</p></div><div><input type="number" min="0" value={inputs.defFlat} onChange={(e) => handleFlat(e.target.value)} placeholder="Cal" className="w-full px-3 py-2 border rounded-lg" /><p className="text-xs text-gray-500 mt-1">Flat (cal)</p></div></div>{bmr && inputs.defFlat && <p className="text-sm mt-2"><span className="font-semibold">Goal:</span> {bmr - parseInt(inputs.defFlat)} cal</p>}</div>
                  <div className="grid grid-cols-2 gap-4"><div><label className="block text-sm font-medium mb-1">Start Hour</label><input type="number" min="0" max="23" value={inputs.startHr} onChange={(e) => setInputs({...inputs, startHr: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div><div><label className="block text-sm font-medium mb-1">End Hour</label><input type="number" min="0" max="23" value={inputs.endHr} onChange={(e) => setInputs({...inputs, endHr: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div></div>
                </div>
                <button onClick={save} className="w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 rounded-lg">Save Settings</button>
              </div>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 p-6">
          <div className="max-w-4xl mx-auto space-y-6">
            <div className="bg-white rounded-2xl shadow-xl p-8">
              <div className="flex justify-between items-center mb-6">
                <div><h1 className="text-3xl font-bold">🥔 Potato Tracker</h1>{b && <p className="text-sm text-gray-500">Time: {b.hr}:00</p>}</div>
                <div className="flex gap-2">
                  <button onClick={() => setView('weights')} className="px-4 py-2 bg-purple-100 hover:bg-purple-200 rounded-lg text-sm">⚖️ Weight</button>
                  <button onClick={() => setView('history')} className="px-4 py-2 bg-blue-100 hover:bg-blue-200 rounded-lg text-sm">📅 History</button>
                  <button onClick={() => setView('setup')} className="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm">⚙️ Settings</button>
                </div>
              </div>
              {st > 0 && <div className="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-4"><p className="text-purple-800 font-semibold">🔥 {st} day streak!</p></div>}
              {ws && <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6"><h3 className="font-semibold text-blue-900 mb-2 flex items-center gap-2"><TrendingUp />Last 7 Days</h3><div className="grid grid-cols-3 gap-4 text-sm"><div><p className="text-blue-700">Avg Net Cal</p><p className="text-lg font-bold text-blue-900">{ws.avg}</p></div><div><p className="text-blue-700">Avg Remaining</p><p className="text-lg font-bold text-blue-900">{ws.avgRem}</p></div><div><p className="text-blue-700">Success</p><p className="text-lg font-bold text-blue-900">{ws.ok}/{ws.tot}</p></div></div></div>}
              {b && b.msg ? <div className="bg-blue-50 border border-blue-200 rounded-lg p-6 text-center"><Clock /><p className="text-lg text-gray-700 mt-3">{b.msg}</p></div> : b && <><div className="mb-6"><div className="flex justify-between mb-2"><span className="text-sm font-medium">Progress</span><span className="text-sm font-medium">{b.cons} / {b.goal} cal {b.exCal > 0 && <span className="text-green-600">(+{b.exCal} from exercise)</span>}</span></div><div className="w-full bg-gray-200 rounded-full h-4"><div className={`h-full rounded-full ${prog <= 100 ? 'bg-green-500' : 'bg-red-500'}`} style={{width: `${prog}%`}} /></div></div><div className="grid grid-cols-3 gap-4 mb-6"><div className="bg-green-50 border border-green-200 rounded-lg p-4"><p className="text-sm text-gray-600 mb-1">Budgeted</p><p className="text-3xl font-bold text-green-700">{b.bud}</p><p className="text-xs text-gray-500 mt-1">{b.perHr}/hr</p></div><div className="bg-orange-50 border border-orange-200 rounded-lg p-4"><p className="text-sm text-gray-600 mb-1">Net Consumed</p><p className="text-3xl font-bold text-orange-700">{b.cons}</p>{b.exCal > 0 && <p className="text-xs text-gray-500 mt-1">{b.grossCons} - {b.exCal}</p>}</div><div className={`border rounded-lg p-4 ${b.rem >= 0 ? 'bg-blue-50 border-blue-200' : 'bg-red-50 border-red-200'}`}><p className="text-sm text-gray-600 mb-1">Remaining</p><p className={`text-3xl font-bold ${b.rem >= 0 ? 'text-blue-700' : 'text-red-700'}`}>{b.rem}</p></div></div><div className="bg-amber-50 rounded-lg p-4"><p className="text-sm text-gray-600"><span className="font-semibold">Goal:</span> {settings.goal} cal<span className="mx-2">|</span><span className="font-semibold">Hours:</span> {settings.start}:00-{settings.end}:00</p></div></>}
            </div>
            <div className="bg-white rounded-2xl shadow-xl p-8">
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-2xl font-bold flex items-center gap-2"><Utensils />Log Feed</h2>
                <button onClick={() => setShowCalc(true)} className="px-4 py-2 bg-blue-100 hover:bg-blue-200 rounded-lg text-2xl">🧮</button>
              </div>
              <div className="mb-4"><p className="text-sm text-gray-600 mb-2">Quick Add:</p><div className="flex gap-2"><button onClick={() => quick(100)} className="px-4 py-2 bg-green-100 hover:bg-green-200 rounded-lg text-green-800 font-medium">+100</button><button onClick={() => quick(200)} className="px-4 py-2 bg-green-100 hover:bg-green-200 rounded-lg text-green-800 font-medium">+200</button><button onClick={() => quick(500)} className="px-4 py-2 bg-green-100 hover:bg-green-200 rounded-lg text-green-800 font-medium">+500</button></div></div>
              <div className="grid grid-cols-4 gap-3 mb-6"><div><label className="block text-sm font-medium mb-1">Hour (optional)</label><input type="number" min="0" max="23" value={newFeed.hour} onChange={(e) => setNewFeed({...newFeed, hour: e.target.value})} placeholder="now" className="w-full px-3 py-2 border rounded-lg" /></div><div><label className="block text-sm font-medium mb-1">Calories</label><input type="number" min="0" value={newFeed.cal} onChange={(e) => setNewFeed({...newFeed, cal: e.target.value})} placeholder="450" className="w-full px-3 py-2 border rounded-lg" /></div><div><label className="block text-sm font-medium mb-1">Note</label><input type="text" value={newFeed.note} onChange={(e) => setNewFeed({...newFeed, note: e.target.value})} placeholder="snack" className="w-full px-3 py-2 border rounded-lg" /></div><div className="flex items-end"><button onClick={add} className="w-full px-6 py-2 bg-orange-500 hover:bg-orange-600 text-white font-semibold rounded-lg">Add</button></div></div>
              <div className="space-y-2"><h3 className="text-lg font-semibold mb-3">Today's Feeds</h3>{!feeds.length ? <p className="text-gray-500 text-center py-8">No feeds yet</p> : feeds.map((f, i) => <div key={i} className="bg-gray-50 p-3 rounded-lg">{editIdx === i ? <div className="flex gap-2 items-center"><input type="number" min="0" max="23" value={editVals.hour} onChange={(e) => setEditVals({...editVals, hour: e.target.value})} className="w-20 px-2 py-1 border rounded" /><input type="number" min="0" value={editVals.cal} onChange={(e) => setEditVals({...editVals, cal: e.target.value})} className="w-24 px-2 py-1 border rounded" /><input type="text" value={editVals.note} onChange={(e) => setEditVals({...editVals, note: e.target.value})} className="flex-1 px-2 py-1 border rounded" /><button onClick={() => saveEdit(i)} className="text-green-600 font-medium">Save</button><button onClick={() => setEditIdx(null)} className="text-gray-600 font-medium">Cancel</button></div> : <div className="flex justify-between items-center"><div><span className="font-semibold">{f.hour}:00</span><span className="mx-2 text-gray-400">•</span><span>{f.cal} cal</span>{f.note && <span className="ml-2 text-gray-500 text-sm">({f.note})</span>}</div><div className="flex gap-2"><button onClick={() => startEdit(i)} className="text-blue-600 text-sm font-medium">Edit</button><button onClick={() => del(i)} className="text-red-600 text-sm font-medium">Delete</button></div></div>}</div>)}</div>
            </div>
            <div className="bg-white rounded-2xl shadow-xl p-8">
              <h2 className="text-2xl font-bold mb-4 flex items-center gap-2"><span className="text-2xl">💪</span>Log Exercise</h2>
              <div className="mb-4"><p className="text-sm text-gray-600 mb-2">Quick Add:</p><div className="flex gap-2"><button onClick={() => quickEx(100)} className="px-4 py-2 bg-blue-100 hover:bg-blue-200 rounded-lg text-blue-800 font-medium">100</button><button onClick={() => quickEx(200)} className="px-4 py-2 bg-blue-100 hover:bg-blue-200 rounded-lg text-blue-800 font-medium">200</button><button onClick={() => quickEx(300)} className="px-4 py-2 bg-blue-100 hover:bg-blue-200 rounded-lg text-blue-800 font-medium">300</button></div></div>
              <div className="grid grid-cols-4 gap-3 mb-6"><div><label className="block text-sm font-medium mb-1">Hour (optional)</label><input type="number" min="0" max="23" value={newExercise.hour} onChange={(e) => setNewExercise({...newExercise, hour: e.target.value})} placeholder="now" className="w-full px-3 py-2 border rounded-lg" /></div><div><label className="block text-sm font-medium mb-1">Calories</label><input type="number" min="0" value={newExercise.cal} onChange={(e) => setNewExercise({...newExercise, cal: e.target.value})} placeholder="300" className="w-full px-3 py-2 border rounded-lg" /></div><div><label className="block text-sm font-medium mb-1">Activity</label><input type="text" value={newExercise.note} onChange={(e) => setNewExercise({...newExercise, note: e.target.value})} placeholder="run" className="w-full px-3 py-2 border rounded-lg" /></div><div className="flex items-end"><button onClick={addExercise} className="w-full px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-lg">Add</button></div></div>
              <div className="space-y-2"><h3 className="text-lg font-semibold mb-3">Today's Exercise</h3>{!exercises.length ? <p className="text-gray-500 text-center py-8">No exercise logged yet</p> : exercises.map((ex, i) => <div key={i} className="bg-blue-50 p-3 rounded-lg">{editExIdx === i ? <div className="flex gap-2 items-center"><input type="number" min="0" max="23" value={editExVals.hour} onChange={(e) => setEditExVals({...editExVals, hour: e.target.value})} className="w-20 px-2 py-1 border rounded" /><input type="number" min="0" value={editExVals.cal} onChange={(e) => setEditExVals({...editExVals, cal: e.target.value})} className="w-24 px-2 py-1 border rounded" /><input type="text" value={editExVals.note} onChange={(e) => setEditExVals({...editExVals, note: e.target.value})} className="flex-1 px-2 py-1 border rounded" /><button onClick={() => saveEditEx(i)} className="text-green-600 font-medium">Save</button><button onClick={() => setEditExIdx(null)} className="text-gray-600 font-medium">Cancel</button></div> : <div className="flex justify-between items-center"><div><span className="font-semibold">{ex.hour}:00</span><span className="mx-2 text-gray-400">•</span><span className="text-green-600 font-bold">+{ex.cal} cal</span>{ex.note && <span className="ml-2 text-gray-500 text-sm">({ex.note})</span>}</div><div className="flex gap-2"><button onClick={() => startEditEx(i)} className="text-blue-600 text-sm font-medium">Edit</button><button onClick={() => delEx(i)} className="text-red-600 text-sm font-medium">Delete</button></div></div>}</div>)}</div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<PotatoTracker />);
  </script>
</body>
</html>
